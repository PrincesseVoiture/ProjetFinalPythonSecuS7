{% extends "base.html" %}
{% block content %}
<div class="box">
    <h2>Terminal multi-OS</h2>

    <form method="POST" id="terminal-form">
        <select name="agent_id" required>
            {% for agent in agents %}
            <option value="{{ agent.hostname }}" {% if agent.hostname == selected_agent_id %}selected{% endif %}>
                {{ agent.hostname }}
            </option>
            {% endfor %}
        </select>
        <input type="text" name="command" placeholder="Commande (ex: ls / dir / echo hello)" required>
        <button type="submit">Envoyer</button>
    </form>

    <h3>Historique :</h3>
    <pre class="terminal-output">{{ output }}</pre>
</div>
</div>

<script>
const input = document.querySelector('input[name="command"]');
input.focus();

// Soumission avec Enter
input.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        document.getElementById('terminal-form').submit();
    }
});

// Focus automatique aprÃ¨s soumission
const form = document.getElementById('terminal-form');
form.addEventListener('submit', () => {
    setTimeout(() => input.focus(), 100);
});
</script>
{% endblock %}